---
import { getCollection } from "astro:content";
import { COLLECTION_TYPES, type ValidCollection } from "../../utils/constants";
import { getFirstEntrySlug } from "../../utils/entryUtils";

export async function getStaticPaths() {
  const paths = [];

  for (const collectionName of COLLECTION_TYPES) {
    const entries = await getCollection(collectionName);
    const firstSlug = getFirstEntrySlug(entries);

    if (firstSlug) {
      paths.push({
        params: { collection: collectionName },
        props: { firstSlug, collectionName },
      });
    }
  }

  return paths;
}

interface Props {
  firstSlug: string;
  collectionName: ValidCollection;
}

return Astro.redirect(
  `${import.meta.env.BASE_URL.replace(/\/$/, "")}/${Astro.props.collectionName}/${Astro.props.firstSlug}`,
  301
);
---
